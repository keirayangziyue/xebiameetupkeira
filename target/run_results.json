{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.8.7", "generated_at": "2024-11-18T11:55:16.450736Z", "invocation_id": "00174e9d-b4d7-4d46-af11-3e9b8a01a209", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-18T11:54:50.823831Z", "completed_at": "2024-11-18T11:54:50.858035Z"}, {"name": "execute", "started_at": "2024-11-18T11:54:50.858998Z", "completed_at": "2024-11-18T11:54:54.103359Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 3.3015973567962646, "adapter_response": {"_message": "CREATE TABLE (7.7k rows, 147.1 KiB processed)", "code": "CREATE TABLE", "rows_affected": 7713, "bytes_processed": 150589, "bytes_billed": 10485760, "location": "EU", "project_id": "keira-xebia", "job_id": "5ee5f5c8-78d3-4b54-9d20-44a446cc446f", "slot_ms": 3954}, "message": "CREATE TABLE (7.7k rows, 147.1 KiB processed)", "failures": null, "unique_id": "model.keira_project.stg_group_topics", "compiled": true, "compiled_code": "\n\nWITH group_topics AS (\n    SELECT\n        group_id,\n        topic\n    FROM `keira-xebia`.`meetupservice`.`source_groups`,\n    UNNEST(topics) AS topic\n)\n\nSELECT\n    group_id,\n    topic\nFROM group_topics", "relation_name": "`keira-xebia`.`meetupservice`.`stg_group_topics`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-18T11:54:50.830883Z", "completed_at": "2024-11-18T11:54:50.864798Z"}, {"name": "execute", "started_at": "2024-11-18T11:54:50.883693Z", "completed_at": "2024-11-18T11:54:54.424064Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 3.6217479705810547, "adapter_response": {"_message": "CREATE TABLE (711.0 rows, 442.7 KiB processed)", "code": "CREATE TABLE", "rows_affected": 711, "bytes_processed": 453370, "bytes_billed": 10485760, "location": "EU", "project_id": "keira-xebia", "job_id": "a9f7670f-3db1-4377-b6b0-e94932c602b8", "slot_ms": 3425}, "message": "CREATE TABLE (711.0 rows, 442.7 KiB processed)", "failures": null, "unique_id": "model.keira_project.stg_groups", "compiled": true, "compiled_code": "\n\n\nWITH stggroups AS(\n    SELECT\n      group_id, \n      name AS group_name,\n      EXTRACT(YEAR FROM TIMESTAMP_SECONDS(CAST(created / 1000 AS INT64))) AS group_created_year, \n      EXTRACT(MONTH FROM TIMESTAMP_SECONDS(CAST(created / 1000 AS INT64))) AS group_created_month,\n      description AS group_description,\n      LOWER(city) AS group_city,\n      lat AS group_lat,\n      lon AS group_lon   \n    FROM `keira-xebia`.`meetupservice`.`source_groups`\n)\n\nSELECT \n  group_id, --unique identifier of a group\n  group_name,\n  group_created_year,\n  group_created_month,\n  group_description,\n  group_city,\n  group_lat,\n  group_lon\nFROM stggroups", "relation_name": "`keira-xebia`.`meetupservice`.`stg_groups`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-18T11:54:50.819467Z", "completed_at": "2024-11-18T11:54:50.872049Z"}, {"name": "execute", "started_at": "2024-11-18T11:54:50.908557Z", "completed_at": "2024-11-18T11:54:54.433119Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 3.631741762161255, "adapter_response": {"_message": "CREATE TABLE (2.0 rows, 0 processed)", "code": "CREATE TABLE", "rows_affected": 2, "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "keira-xebia", "job_id": "e24fe6a9-1459-42df-b893-6ba979683d19", "slot_ms": 3045}, "message": "CREATE TABLE (2.0 rows, 0 processed)", "failures": null, "unique_id": "model.keira_project.my_first_dbt_model", "compiled": true, "compiled_code": "/*\n    Welcome to your first dbt model!\n    Did you know that you can also configure models directly within SQL files?\n    This will override configurations stated in dbt_project.yml\n\n    Try changing \"table\" to \"view\" below\n*/\n\n\n\nwith source_data as (\n\n    select 1 as id\n    union all\n    select null as id\n\n)\n\nselect *\nfrom source_data\n\n/*\n    Uncomment the line below to remove records with null `id` values\n*/\n\n-- where id is not null", "relation_name": "`keira-xebia`.`meetupservice`.`my_first_dbt_model`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-18T11:54:50.803532Z", "completed_at": "2024-11-18T11:54:50.845237Z"}, {"name": "execute", "started_at": "2024-11-18T11:54:50.845953Z", "completed_at": "2024-11-18T11:54:57.607706Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 6.807090997695923, "adapter_response": {"_message": "CREATE TABLE (174.1k rows, 12.1 MiB processed)", "code": "CREATE TABLE", "rows_affected": 174139, "bytes_processed": 12638672, "bytes_billed": 13631488, "location": "EU", "project_id": "keira-xebia", "job_id": "9204185e-9023-44b2-add1-90f09153a04b", "slot_ms": 11216}, "message": "CREATE TABLE (174.1k rows, 12.1 MiB processed)", "failures": null, "unique_id": "model.keira_project.stg_events_o", "compiled": true, "compiled_code": "\n\n\nWITH rsvp AS (\n    SELECT \n        venue_id,\n        group_id,\n        name AS event_name,\n        TIMESTAMP_SECONDS(CAST(time / 1000 AS INT64)) AS event_start_time, --timestamp\n        rsvp.user_id AS rsvp_user_id,\n        rsvp.response AS rsvp_response,\n        TIMESTAMP_SECONDS(CAST(rsvp.when / 1000 AS INT64)) AS rsvp_response_time, --timestamp\n        rsvp.guests AS rsvp_guests,\n        status AS event_status,\n        duration AS event_duration,\n        rsvp_limit AS rsvp_total_limit,\n        TIMESTAMP_SECONDS(CAST(created / 1000 AS INT64)) AS event_create_time, --timestamp\n        description AS event_description\n    FROM \n      `keira-xebia`.`meetupservice`.`source_events`,\n      UNNEST(rsvps) AS rsvp\n),\n\neventid AS(\n    SELECT \n        CAST(FARM_FINGERPRINT(\n            CONCAT(event_name, CAST(group_id AS STRING), CAST(venue_id AS STRING), CAST(event_start_time AS STRING))) \n            AS STRING) AS event_id,\n        *\n    FROM rsvp\n)\n\nSELECT \n    event_id,\n    event_name,\n    event_start_time,\n    group_id,\n    venue_id,\n    event_status,\n    event_duration,\n    rsvp_total_limit,\n    event_create_time,\n    event_description,\n    rsvp_user_id,\n    rsvp_response,\n    rsvp_response_time,\n    rsvp_guests\nFROM eventid", "relation_name": "`keira-xebia`.`meetupservice`.`stg_events_o`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-18T11:54:54.446963Z", "completed_at": "2024-11-18T11:54:54.545744Z"}, {"name": "execute", "started_at": "2024-11-18T11:54:54.546733Z", "completed_at": "2024-11-18T11:54:57.709410Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 3.2674789428710938, "adapter_response": {"_message": "CREATE TABLE (1.7k rows, 97.0 KiB processed)", "code": "CREATE TABLE", "rows_affected": 1732, "bytes_processed": 99290, "bytes_billed": 10485760, "location": "EU", "project_id": "keira-xebia", "job_id": "c021364a-f3f6-42d4-8a9b-02b2c0ebab8f", "slot_ms": 4241}, "message": "CREATE TABLE (1.7k rows, 97.0 KiB processed)", "failures": null, "unique_id": "model.keira_project.stg_venues", "compiled": true, "compiled_code": "\n\nSELECT \n    venue_id,\n    name AS venue_name,\n    LOWER(city) AS venue_city,\n    LOWER(country) AS venue_country,\n    lat AS venue_lat,\n    lon AS venue_lon\nFROM `keira-xebia`.`meetupservice`.`source_venues`", "relation_name": "`keira-xebia`.`meetupservice`.`stg_venues`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-18T11:54:54.110427Z", "completed_at": "2024-11-18T11:54:54.116719Z"}, {"name": "execute", "started_at": "2024-11-18T11:54:54.117341Z", "completed_at": "2024-11-18T11:54:57.874169Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 3.7653450965881348, "adapter_response": {"_message": "CREATE TABLE (57.8k rows, 1.3 MiB processed)", "code": "CREATE TABLE", "rows_affected": 57773, "bytes_processed": 1407220, "bytes_billed": 10485760, "location": "EU", "project_id": "keira-xebia", "job_id": "24bf5756-9ad2-4973-b79b-554dd07fa1db", "slot_ms": 4750}, "message": "CREATE TABLE (57.8k rows, 1.3 MiB processed)", "failures": null, "unique_id": "model.keira_project.stg_users", "compiled": true, "compiled_code": "\n\nWITH users AS (\n    SELECT\n        user_id,\n        LOWER(country) AS user_country,\n        LOWER(city) AS user_city,\n        LOWER(hometown) AS user_hometown\n    FROM `keira-xebia`.`meetupservice`.`source_users`   \n)\n\nSELECT \n    user_id, \n    user_country,\n    user_city,\n    user_hometown\nFROM users", "relation_name": "`keira-xebia`.`meetupservice`.`stg_users`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-18T11:54:54.433717Z", "completed_at": "2024-11-18T11:54:54.442938Z"}, {"name": "execute", "started_at": "2024-11-18T11:54:54.443892Z", "completed_at": "2024-11-18T11:54:58.101113Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 3.6713201999664307, "adapter_response": {"_message": "CREATE TABLE (145.5k rows, 4.5 MiB processed)", "code": "CREATE TABLE", "rows_affected": 145464, "bytes_processed": 4690264, "bytes_billed": 10485760, "location": "EU", "project_id": "keira-xebia", "job_id": "be1c15e2-fdd4-4726-bd5d-a50b2280538f", "slot_ms": 4346}, "message": "CREATE TABLE (145.5k rows, 4.5 MiB processed)", "failures": null, "unique_id": "model.keira_project.stg_users_groups", "compiled": true, "compiled_code": "\n\nWITH usergroup AS (\n    SELECT\n        user_id,\n        membership.group_id AS join_group_id,\n        TIMESTAMP_SECONDS(CAST(membership.joined / 1000 AS INT64)) AS join_group_time --timestamp\n    FROM `keira-xebia`.`meetupservice`.`source_users`,\n    UNNEST(memberships) AS membership\n)\n\nSELECT \n    user_id, \n    join_group_id,\n    join_group_time\nFROM usergroup", "relation_name": "`keira-xebia`.`meetupservice`.`stg_users_groups`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-18T11:54:57.719129Z", "completed_at": "2024-11-18T11:54:57.727085Z"}, {"name": "execute", "started_at": "2024-11-18T11:54:57.727948Z", "completed_at": "2024-11-18T11:54:58.702312Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.9850833415985107, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "keira-xebia", "job_id": "eae8c0c1-ad26-4ac6-90e5-f6a522954cc9", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.keira_project.my_second_dbt_model", "compiled": true, "compiled_code": "-- Use the `ref` function to select from other models\n\nselect *\nfrom `keira-xebia`.`meetupservice`.`my_first_dbt_model`\nwhere id = 1", "relation_name": "`keira-xebia`.`meetupservice`.`my_second_dbt_model`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-18T11:54:57.610559Z", "completed_at": "2024-11-18T11:54:57.614913Z"}, {"name": "execute", "started_at": "2024-11-18T11:54:57.615254Z", "completed_at": "2024-11-18T11:55:01.051008Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 3.441230058670044, "adapter_response": {"_message": "CREATE TABLE (711.0 rows, 448.3 KiB processed)", "code": "CREATE TABLE", "rows_affected": 711, "bytes_processed": 459058, "bytes_billed": 10485760, "location": "EU", "project_id": "keira-xebia", "job_id": "fb968f60-b4a0-4c10-8a36-09639f98f004", "slot_ms": 3472}, "message": "CREATE TABLE (711.0 rows, 448.3 KiB processed)", "failures": null, "unique_id": "model.keira_project.certified_groups", "compiled": true, "compiled_code": "\n\n\nSELECT \n    group_id, --unique identifier of a group\n    group_name,\n    group_created_year,\n    group_created_month,\n    group_description,\n    group_city,\n    group_lat,\n    group_lon\nFROM `keira-xebia`.`meetupservice`.`stg_groups`", "relation_name": "`keira-xebia`.`meetupservice`.`certified_groups`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-18T11:54:57.882755Z", "completed_at": "2024-11-18T11:54:57.890242Z"}, {"name": "execute", "started_at": "2024-11-18T11:54:57.891011Z", "completed_at": "2024-11-18T11:55:01.600408Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 3.719270944595337, "adapter_response": {"_message": "CREATE TABLE (6.2k rows, 264.4 MiB processed)", "code": "CREATE TABLE", "rows_affected": 6182, "bytes_processed": 277285970, "bytes_billed": 277872640, "location": "EU", "project_id": "keira-xebia", "job_id": "ed012043-7e87-48cc-8a28-b1422405ae4e", "slot_ms": 11467}, "message": "CREATE TABLE (6.2k rows, 264.4 MiB processed)", "failures": null, "unique_id": "model.keira_project.stg_events", "compiled": true, "compiled_code": "\n\n\nWITH events AS (\n    SELECT DISTINCT\n        event_id,\n        venue_id,\n        event_start_time, --timestamp\n        event_status,\n        event_duration,\n        rsvp_total_limit,\n        event_create_time, --timestamp\n        group_id,\n        event_name,\n        event_description\n    FROM \n      `keira-xebia`.`meetupservice`.`stg_events_o`\n    WHERE event_id IS NOT NULL \n),\n\nvenues AS(\n    SELECT \n        venue_id,\n        name AS venue_name,\n        LOWER(city) AS venue_city,\n        LOWER(country) AS venue_country,\n        lat AS venue_lat,\n        lon AS venue_lon\n    FROM `keira-xebia`.`meetupservice`.`source_venues`\n),\n\nstaging AS(\n    SELECT\n        e.event_id,\n        e.group_id,\n        e.venue_id,\n        e.event_name,\n        e.event_start_time,\n        e.event_status,\n        e.event_duration,\n        e.event_create_time,\n        e.rsvp_total_limit,\n        e.event_description,\n        v.venue_name,\n        v.venue_city,\n        v.venue_country,\n        v.venue_lat,\n        v.venue_lon\n      FROM events e\n      LEFT JOIN venues v\n        ON e.venue_id = v.venue_id\n)\n\n\nSELECT\n    event_id,\n    event_name,\n    group_id,\n    venue_id,\n    event_start_time,\n    event_status,\n    event_duration,\n    event_create_time,\n    rsvp_total_limit,\n    event_description,\n    venue_name,\n    venue_city,\n    venue_country,\n    venue_lat,\n    venue_lon\nFROM staging", "relation_name": "`keira-xebia`.`meetupservice`.`stg_events`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-18T11:54:58.106500Z", "completed_at": "2024-11-18T11:54:58.111956Z"}, {"name": "execute", "started_at": "2024-11-18T11:54:58.112591Z", "completed_at": "2024-11-18T11:55:01.945511Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 3.8400719165802, "adapter_response": {"_message": "CREATE TABLE (174.0k rows, 20.4 MiB processed)", "code": "CREATE TABLE", "rows_affected": 173988, "bytes_processed": 21429109, "bytes_billed": 22020096, "location": "EU", "project_id": "keira-xebia", "job_id": "34422cfd-3ee0-4234-bb3d-96adbaf28241", "slot_ms": 6950}, "message": "CREATE TABLE (174.0k rows, 20.4 MiB processed)", "failures": null, "unique_id": "model.keira_project.stg_events_rsvp", "compiled": true, "compiled_code": "\n\nSELECT \n    event_id,\n    event_name,\n    event_start_time,\n    group_id,\n    venue_id,\n    rsvp_user_id,\n    rsvp_response,\n    rsvp_response_time,\n    rsvp_guests\nFROM `keira-xebia`.`meetupservice`.`stg_events_o`\nWHERE event_id IS NOT NULL", "relation_name": "`keira-xebia`.`meetupservice`.`stg_events_rsvp`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-18T11:54:58.704942Z", "completed_at": "2024-11-18T11:54:58.708697Z"}, {"name": "execute", "started_at": "2024-11-18T11:54:58.708982Z", "completed_at": "2024-11-18T11:55:02.042809Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 3.338624954223633, "adapter_response": {"_message": "CREATE TABLE (57.8k rows, 1.3 MiB processed)", "code": "CREATE TABLE", "rows_affected": 57773, "bytes_processed": 1407221, "bytes_billed": 10485760, "location": "EU", "project_id": "keira-xebia", "job_id": "2a80c93e-a46c-40da-81b4-b6934d660e23", "slot_ms": 4755}, "message": "CREATE TABLE (57.8k rows, 1.3 MiB processed)", "failures": null, "unique_id": "model.keira_project.certified_users", "compiled": true, "compiled_code": "\n\nSELECT \n    user_id, \n    user_country,\n    user_city,\n    user_hometown\nFROM `keira-xebia`.`meetupservice`.`stg_users`", "relation_name": "`keira-xebia`.`meetupservice`.`certified_users`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-18T11:55:01.948104Z", "completed_at": "2024-11-18T11:55:01.951528Z"}, {"name": "execute", "started_at": "2024-11-18T11:55:01.951795Z", "completed_at": "2024-11-18T11:55:06.973220Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 5.025713920593262, "adapter_response": {"_message": "CREATE TABLE (173.9k rows, 21.7 MiB processed)", "code": "CREATE TABLE", "rows_affected": 173895, "bytes_processed": 22744382, "bytes_billed": 31457280, "location": "EU", "project_id": "keira-xebia", "job_id": "f41f0169-a6a5-4af3-9239-ad8eaae2069e", "slot_ms": 38250}, "message": "CREATE TABLE (173.9k rows, 21.7 MiB processed)", "failures": null, "unique_id": "model.keira_project.certified_events_users_rsvp", "compiled": true, "compiled_code": "\n\nWITH rsvp AS (\n    SELECT \n        event_id,\n        venue_id,\n        group_id,\n        event_name,\n        DATE(FORMAT_TIMESTAMP('%Y-%m-%d', event_start_time)) AS event_date, --YYYY-MM-DD\n        rsvp_user_id,\n        rsvp_response,\n        DATE(FORMAT_TIMESTAMP('%Y-%m-%d', rsvp_response_time)) AS rsvp_response_date, --YYYY-MM-DD\n        rsvp_guests,\n        DATE(MIN(rsvp_response_time) OVER (\n            PARTITION BY event_id, rsvp_user_id))\n            AS first_response_date,\n        ROW_NUMBER () OVER (\n            PARTITION BY event_id, rsvp_user_id\n            ORDER BY rsvp_response_time DESC ) AS row_n\n    FROM \n      `keira-xebia`.`meetupservice`.`stg_events_rsvp`\n),\n\nfinal AS(\n    SELECT \n        event_id,\n        venue_id,\n        group_id,\n        event_name,\n        event_date,\n        rsvp_user_id,\n        rsvp_response AS final_response,\n        rsvp_response_date AS final_response_date,\n        rsvp_guests AS final_response_guests,\n        first_response_date,\n        -- time duration from the last response to event day.\n        DATE_DIFF(event_date, first_response_date, DAY) AS first_response_to_start,\n        DATE_DIFF(event_date, rsvp_response_date, DAY) AS final_response_to_start, \n        CASE WHEN rsvp_response_date != first_response_date THEN 1 ELSE 0 END AS response_changed\n    FROM rsvp\n    WHERE row_n = 1\n),\n\nstaging AS(\n    SELECT \n        f.event_id,\n        f.event_name,\n        f.event_date,\n        f.group_id,\n        f.venue_id,\n        f.rsvp_user_id,\n        f.first_response_date,\n        f.final_response_date,\n        f.final_response,\n        f.final_response_guests,\n        f.first_response_to_start,\n        f.final_response_to_start,\n        f.response_changed,\n        u.user_country,\n        u.user_city,\n        v.venue_country,\n        v.venue_city,\n        CASE WHEN u.user_country = v.venue_country AND v.venue_city = u.user_city\n        THEN 'yes' ELSE 'no' END AS user_venue_same_location\n    FROM final f\n    JOIN `keira-xebia`.`meetupservice`.`stg_users` u \n    ON f.rsvp_user_id = u.user_id\n    JOIN  `keira-xebia`.`meetupservice`.`stg_venues` v\n    ON f.venue_id = v.venue_id\n)\n\n\nSELECT \n    event_id,\n    event_name,\n    event_date,\n    group_id,\n    venue_id,\n    rsvp_user_id,\n    first_response_date,\n    final_response_date,\n    final_response,\n    final_response_guests,\n    first_response_to_start,\n    final_response_to_start,\n    response_changed,\n    user_country,\n    user_city,\n    venue_country,\n    venue_city,\n    user_venue_same_location\nFROM staging", "relation_name": "`keira-xebia`.`meetupservice`.`certified_events_users_rsvp`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-18T11:55:06.980175Z", "completed_at": "2024-11-18T11:55:06.984254Z"}, {"name": "execute", "started_at": "2024-11-18T11:55:06.984768Z", "completed_at": "2024-11-18T11:55:10.603639Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 3.627095937728882, "adapter_response": {"_message": "CREATE TABLE (6.2k rows, 31.4 MiB processed)", "code": "CREATE TABLE", "rows_affected": 6182, "bytes_processed": 32933123, "bytes_billed": 33554432, "location": "EU", "project_id": "keira-xebia", "job_id": "6e41ebfd-77cb-4e08-b62f-f072cba4c3b8", "slot_ms": 11755}, "message": "CREATE TABLE (6.2k rows, 31.4 MiB processed)", "failures": null, "unique_id": "model.keira_project.certified_events", "compiled": true, "compiled_code": "\n\n\nWITH userrsvp AS (\n    SELECT \n        event_id,\n        event_name,\n        event_date,\n        group_id,\n        venue_id,\n        COUNT(rsvp_user_id) AS total_user,\n        SUM(final_response_guests) AS total_guests,\n        SUM(CASE WHEN final_response = 'yes' THEN 1 ELSE 0 END) AS accept_user_cnt,\n        SUM(CASE WHEN final_response != 'yes' THEN 1 ELSE 0 END) AS decline_user_cnt,\n        SUM(CASE WHEN response_changed = 1 THEN 1 ELSE 0 END) * 1.00 / \n            COUNT(rsvp_user_id) AS response_change_rate,\n        AVG(first_response_to_start) AS avg_first_response_to_start,\n        AVG(final_response_to_start) AS avg_final_response_to_start,\n        SUM(CASE WHEN user_venue_same_location = 'yes' THEN 1 ELSE 0 END) AS location_same_cnt,\n        SUM(CASE WHEN user_venue_same_location != 'yes' THEN 1 ELSE 0 END) AS location_diff_cnt,\n        SUM(CASE WHEN final_response = 'yes' AND user_venue_same_location = 'yes' THEN 1 ELSE 0 END)\n            AS location_same_accept_cnt,\n        SUM(CASE WHEN final_response = 'no' AND user_venue_same_location = 'yes' THEN 1 ELSE 0 END)\n            AS location_same_decline_cnt\n    FROM `keira-xebia`.`meetupservice`.`certified_events_users_rsvp`\n    GROUP BY event_id, event_name, event_date, group_id, venue_id\n),\n\nevents AS (\n    SELECT \n        event_id,\n        event_name,\n        group_id,\n        venue_id,\n        DATE(FORMAT_TIMESTAMP('%Y-%m-%d', event_start_time)) AS event_date,\n        event_status,\n        event_duration,\n        CASE\n            WHEN event_duration IS NULL THEN 'unknown'\n            WHEN event_duration <= 3600000 THEN 'less than 1h'  -- less than 1 hour\n            WHEN event_duration > 3600000 AND event_duration <= 7200000 THEN '1-2h'  -- 1-2 hours\n            WHEN event_duration > 7200000 AND event_duration <= 10800000 THEN '2-3h'  -- 2-3 hours\n            WHEN event_duration > 10800000 THEN 'more than 3h'  -- more than 3 hours\n            ELSE NULL\n        END AS event_duration_level,\n        DATE(FORMAT_TIMESTAMP('%Y-%m-%d', event_create_time)) AS event_create_date,\n        DATE_DIFF(DATE(FORMAT_TIMESTAMP('%Y-%m-%d', event_start_time)),\n            DATE(FORMAT_TIMESTAMP('%Y-%m-%d', event_create_time)), DAY) AS create_to_start_duration,\n        event_description,\n        rsvp_total_limit,\n        venue_name,\n        venue_country,\n        venue_city,\n        venue_lat,\n        venue_lon\n    FROM `keira-xebia`.`meetupservice`.`stg_events`\n),\n\nstaging AS (\n    SELECT \n        e.event_id,\n        e.event_name,\n        e.group_id,\n        e.venue_id,\n        e.event_date,\n        e.event_status,\n        e.event_description,\n        e.event_duration,\n        e.event_duration_level,\n        e.event_create_date,\n        e.create_to_start_duration,\n        e.rsvp_total_limit,\n        e.venue_name,\n        e.venue_country,\n        e.venue_city,\n        r.total_user,\n        r.total_guests,\n        r.accept_user_cnt,\n        r.accept_user_cnt * 1.00 / r.total_user AS accept_rate,\n        r.decline_user_cnt,\n        r.decline_user_cnt * 1.00 / r.total_user AS decline_rate,\n        r.response_change_rate,\n        r.avg_first_response_to_start,\n        1- (r.avg_first_response_to_start * 1.00 / NULLIF (create_to_start_duration, 0)) AS first_response_indicator,\n        r.avg_final_response_to_start,\n        1- (r.avg_final_response_to_start * 1.00 / NULLIF (create_to_start_duration, 0)) AS final_response_indicator,\n        r.location_same_cnt,\n        r.location_same_cnt * 1.00 / r.total_user AS location_same_rate,\n        r.location_diff_cnt,\n        r.location_diff_cnt * 1.00 / r.total_user AS location_diff_rate,\n        r.location_same_accept_cnt,\n        r.location_same_decline_cnt\n    FROM events e\n    JOIN userrsvp r \n        ON e.event_id = r.event_id\n)\n\nSELECT\n    event_id,\n    event_name,\n    group_id,\n    venue_id,\n    event_date,\n    event_status,\n    event_description,\n    event_duration,\n    event_duration_level,\n    event_create_date,\n    create_to_start_duration,\n    rsvp_total_limit,\n    venue_name,\n    venue_country,\n    venue_city,\n    total_user,\n    total_guests,\n    accept_user_cnt,\n    accept_rate,\n    decline_user_cnt,\n    decline_rate,\n    response_change_rate,\n    avg_first_response_to_start,\n    first_response_indicator,\n    avg_final_response_to_start,\n    final_response_indicator,\n    location_same_cnt,\n    location_same_rate,\n    location_diff_cnt,\n    location_diff_rate,\n    location_same_accept_cnt,\n    location_same_decline_cnt\nFROM staging", "relation_name": "`keira-xebia`.`meetupservice`.`certified_events`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-18T11:55:06.977383Z", "completed_at": "2024-11-18T11:55:06.984530Z"}, {"name": "execute", "started_at": "2024-11-18T11:55:06.987023Z", "completed_at": "2024-11-18T11:55:12.563989Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 5.587767124176025, "adapter_response": {"_message": "CREATE TABLE (69.5k rows, 11.7 MiB processed)", "code": "CREATE TABLE", "rows_affected": 69497, "bytes_processed": 12272621, "bytes_billed": 20971520, "location": "EU", "project_id": "keira-xebia", "job_id": "1ce17eb1-4f3b-47c2-bbe4-ad9efcefc427", "slot_ms": 4452}, "message": "CREATE TABLE (69.5k rows, 11.7 MiB processed)", "failures": null, "unique_id": "model.keira_project.certified_users_groups", "compiled": true, "compiled_code": "\n\nWITH usergroup AS(\n    SELECT \n        user_id, \n        join_group_id,\n        DATE(FORMAT_TIMESTAMP('%Y-%m-%d', join_group_time)) AS join_group_date\n    FROM `keira-xebia`.`meetupservice`.`stg_users_groups`\n),\n\nuserevent AS(\n    SELECT \n        g.user_id,\n        g.join_group_id,\n        g.join_group_date,\n        SUM( CASE WHEN e.final_response = 'yes' THEN 1 ELSE 0 END ) AS accept_event_cnt,\n        SUM( CASE WHEN e.final_response != 'yes' THEN 1 ELSE 0 END ) AS decline_event_cnt\n    FROM usergroup g\n    LEFT JOIN `keira-xebia`.`meetupservice`.`certified_events_users_rsvp` e\n    ON g.user_id = e.rsvp_user_id\n    AND g.join_group_id = e.group_id\n    WHERE e.event_date >= g.join_group_date\n    GROUP BY g.user_id, g.join_group_id, g.join_group_date\n),\n\nstaging AS (\n    SELECT \n        user_id,\n        join_group_id,\n        join_group_date,\n        accept_event_cnt,\n        decline_event_cnt,\n        accept_event_cnt + decline_event_cnt AS total_event_cnt,\n        accept_event_cnt * 1.00 / (accept_event_cnt + decline_event_cnt) AS group_event_accept_rate\n    FROM userevent\n)\n\nSELECT \n    user_id,\n    join_group_id,\n    join_group_date,\n    accept_event_cnt,\n    decline_event_cnt,\n    total_event_cnt,\n    group_event_accept_rate\nFROM staging", "relation_name": "`keira-xebia`.`meetupservice`.`certified_users_groups`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-18T11:55:12.566958Z", "completed_at": "2024-11-18T11:55:12.571052Z"}, {"name": "execute", "started_at": "2024-11-18T11:55:12.571332Z", "completed_at": "2024-11-18T11:55:16.447209Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 3.8809096813201904, "adapter_response": {"_message": "CREATE TABLE (7.4k rows, 2.2 MiB processed)", "code": "CREATE TABLE", "rows_affected": 7447, "bytes_processed": 2270087, "bytes_billed": 20971520, "location": "EU", "project_id": "keira-xebia", "job_id": "eac7d5fd-e91c-46fc-b986-5e113a1a1d50", "slot_ms": 12632}, "message": "CREATE TABLE (7.4k rows, 2.2 MiB processed)", "failures": null, "unique_id": "model.keira_project.certified_group_topics", "compiled": true, "compiled_code": "\n\nWITH topics AS(\n    SELECT\n        group_id,\n        topic,\n    FROM `keira-xebia`.`meetupservice`.`stg_group_topics`\n),\n\ntopicgroup AS(\n    SELECT \n        t.topic,\n        COUNT (DISTINCT t.group_id) AS topic_group_cnt,\n        COUNT (u.user_id) AS topic_user_cnt\n    FROM `keira-xebia`.`meetupservice`.`stg_group_topics` t\n    JOIN `keira-xebia`.`meetupservice`.`certified_users_groups` u\n    ON t.group_id = u.join_group_id \n    GROUP BY t.topic\n),\n\nstaging AS(\n    SELECT\n        t.group_id,\n        t.topic,\n        g.topic_group_cnt,\n        g.topic_user_cnt\n    FROM topics t\n    JOIN topicgroup g\n    ON t.topic = g.topic \n)\n\n\nSELECT\n    group_id,\n    topic,\n    topic_group_cnt, \n    topic_user_cnt\nFROM staging", "relation_name": "`keira-xebia`.`meetupservice`.`certified_group_topics`"}], "elapsed_time": 26.31113600730896, "args": {"show_resource_report": false, "quiet": false, "log_level_file": "debug", "exclude": [], "enable_legacy_logger": false, "empty": false, "strict_mode": false, "require_resource_names_without_spaces": false, "warn_error_options": {"include": [], "exclude": []}, "indirect_selection": "eager", "use_colors": true, "cache_selected_only": false, "vars": {}, "use_colors_file": true, "write_json": true, "log_level": "info", "static_parser": true, "defer": false, "printer_width": 80, "favor_state": false, "which": "run", "require_explicit_package_overrides_for_builtin_materializations": true, "print": true, "macro_debugging": false, "send_anonymous_usage_stats": true, "log_path": "/Users/keirayang/Desktop/keira_project/logs", "source_freshness_run_project_hooks": false, "version_check": true, "introspect": true, "log_file_max_bytes": 10485760, "log_format_file": "debug", "project_dir": "/Users/keirayang/Desktop/keira_project", "profiles_dir": "/Users/keirayang/.dbt", "partial_parse_file_diff": true, "log_format": "default", "invocation_command": "dbt run", "partial_parse": true, "populate_cache": true, "select": []}}